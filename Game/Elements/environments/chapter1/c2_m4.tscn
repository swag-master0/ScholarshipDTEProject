[gd_scene load_steps=17 format=3 uid="uid://bkvmwrsm7nbyt"]

[ext_resource type="PackedScene" uid="uid://d4nob737a2chy" path="res://Elements/function/objective/objective.tscn" id="1_ghn5u"]
[ext_resource type="PackedScene" uid="uid://ch7t6b0c3tjwr" path="res://Elements/enemies/enemy/enemy.tscn" id="1_mvf3l"]
[ext_resource type="PackedScene" uid="uid://c7ycb57houxl1" path="res://Elements/function/player/player.tscn" id="2_217fp"]
[ext_resource type="PackedScene" uid="uid://4yye08ka71t1" path="res://Elements/environments/misc/_scrappedlevels/c2_m1-old.tscn" id="2_brmf2"]
[ext_resource type="PackedScene" uid="uid://ch3t1bgj51uvs" path="res://Elements/enemies/sentry/sentry.tscn" id="2_gg53i"]
[ext_resource type="PackedScene" uid="uid://cna5dpcxkdqae" path="res://Art/blend/levels_chapter1/c2_m4.blend" id="3_hl1ee"]
[ext_resource type="PackedScene" uid="uid://bbb07r3hee2bp" path="res://Elements/assets/passive/props/prop.tscn" id="7_ee68b"]
[ext_resource type="PackedScene" uid="uid://b5c4qe603h5o" path="res://Elements/assets/hostile/explosive_barrel/explosive_barrel.tscn" id="8_i8g7n"]

[sub_resource type="GDScript" id="GDScript_w4vx7"]
resource_name = "c2_m4-functionality"
script/source = "extends Node3D

var triggered = false
var spawns : int = 0

var amount_to_spawn = 25
var time_between_spawns = 2

@onready var doors = $Doors
@onready var spawnpoints = $Spawnpoints

@export var enemy : PackedScene
@export var sentry : PackedScene

# TODO: make level into a fight chamber


# Called when the node enters the scene tree for the first time.
func _ready():
	for i in doors.get_children():
		i.global_position += Vector3(0, 50, 0)
		i.visible = false



# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(_delta):
	if triggered == true and spawns == 0:
		
		for i in range(amount_to_spawn):
			spawns = i + 1
			
			var desired_enemy = enemy
			
			var rand = randf_range(0, 100)
			if rand > 90:
				desired_enemy = sentry
			
			
			var new_enemy = desired_enemy.instantiate()
			self.add_child(new_enemy)
			
			
			new_enemy.global_position = spawnpoints.get_children()[randi_range(0, spawnpoints.get_children().size()) - 1].global_position
			
			await get_tree().create_timer(time_between_spawns).timeout
		
		if spawns == amount_to_spawn:
			for i in doors.get_children():
				i.global_position += Vector3(0, 50, 0)
				i.visible = false
	
	


func _on_trigger_body_entered(body):
	if body.is_in_group(\"player\") and !triggered:
		triggered = true
		
		for i in doors.get_children():
			i.global_position -= Vector3(0, 50, 0)
			i.visible = true



"

[sub_resource type="NavigationMesh" id="NavigationMesh_u278t"]
vertices = PackedVector3Array(130.25, 0.5, -69.25, 128.75, 0.5, -69.25, 129, 0.5, -60.5, 130.75, 0.5, -69.75, 130.25, 0.5, -69.25, 129, 0.5, -60.5, 149.5, 0.5, -60.5, 149.5, 0.5, -74.25, 149.5, 0.5, -74.25, 130.75, 0.5, -74.25, 130.75, 0.5, -69.75, 110.75, 0.5, -59, 119.5, 0.5, -58.75, 119.5, 0.5, -60.25, 119.5, 0.5, -60.25, 121.25, 0.5, -60.5, 121, 0.5, -69.25, 119.5, 0.5, -60.25, 121, 0.5, -69.25, 110.75, 0.5, -69.25, 110.75, 0.5, -59, 121.25, 0.5, -60.5, 129, 0.5, -60.5, 128.75, 0.5, -69.25, 121, 0.5, -69.25, 110.75, 0.5, -51.25, 119.5, 0.5, -51, 119.5, 0.5, -58.75, 110.75, 0.5, -59, 119.5, 0.5, -51, 110.75, 0.5, -51.25, 110.75, 0.5, -49.75, 110.25, 0.5, -49.25, 108.75, 0.5, -49.25, 109, 0.5, -40.5, 119.5, 0.5, -51, 110.75, 0.5, -49.75, 110.25, 0.5, -49.25, 109, 0.5, -40.5, 119.5, 0.5, -40.5, 50.25, 0.5, -29.25, 48.5, 0.5, -29.25, 48.75, 0.5, -20.5, 50.5, 0.5, -20.5, 89.5, 0.5, -40.25, 91, 0.5, -49.25, 50.75, 0.5, -49.25, 50.75, 0.5, -29.75, 89.5, 0.5, -40.25, 91.25, 0.5, -40.5, 91, 0.5, -49.25, 50.75, 0.5, -29.75, 50.25, 0.5, -29.25, 50.5, 0.5, -20.5, 50.75, 0.5, -18.5, 89.5, 0.5, -18.5, 89.5, 0.5, -40.25, 91.25, 0.5, -40.5, 109, 0.5, -40.5, 108.75, 0.5, -49.25, 91, 0.5, -49.25, 30.75, 0.5, -19, 39.5, 0.5, -18.75, 39.5, 0.5, -20.25, 39.5, 0.5, -20.25, 41.25, 0.5, -20.5, 41, 0.5, -29.25, 39.5, 0.5, -20.25, 41, 0.5, -29.25, 30.75, 0.5, -29.25, 30.75, 0.5, -19, 41.25, 0.5, -20.5, 48.75, 0.5, -20.5, 48.5, 0.5, -29.25, 41, 0.5, -29.25, 30.75, 0.5, -6.25, 39.5, 0.5, -6, 39.5, 0.5, -18.75, 30.75, 0.5, -19, 30.25, 0.5, -4.25, 28.25, 0.5, -4.25, 28.25, 0.5, 4.25, 39.5, 0.5, -6, 30.75, 0.5, -6.25, 30.75, 0.5, -4.75, 30.75, 0.5, -4.75, 30.25, 0.5, -4.25, 28.25, 0.5, 4.25, 39.5, 0.5, 4.25, 39.5, 0.5, -6, 28.25, 0.5, 4.25, 28.25, 0.5, -4.25, -4.25, 0.5, -4.25, -4.25, 0.5, 4.25)
polygons = [PackedInt32Array(2, 1, 0), PackedInt32Array(4, 3, 5), PackedInt32Array(5, 3, 6), PackedInt32Array(6, 3, 7), PackedInt32Array(10, 9, 8), PackedInt32Array(13, 12, 11), PackedInt32Array(16, 15, 14), PackedInt32Array(20, 19, 17), PackedInt32Array(17, 19, 18), PackedInt32Array(24, 23, 21), PackedInt32Array(21, 23, 22), PackedInt32Array(28, 27, 25), PackedInt32Array(25, 27, 26), PackedInt32Array(31, 30, 29), PackedInt32Array(34, 33, 32), PackedInt32Array(36, 35, 37), PackedInt32Array(37, 35, 39), PackedInt32Array(37, 39, 38), PackedInt32Array(43, 42, 40), PackedInt32Array(40, 42, 41), PackedInt32Array(45, 44, 46), PackedInt32Array(46, 44, 47), PackedInt32Array(50, 49, 48), PackedInt32Array(52, 51, 53), PackedInt32Array(53, 51, 54), PackedInt32Array(54, 51, 55), PackedInt32Array(55, 51, 56), PackedInt32Array(60, 59, 57), PackedInt32Array(57, 59, 58), PackedInt32Array(63, 62, 61), PackedInt32Array(66, 65, 64), PackedInt32Array(70, 69, 67), PackedInt32Array(67, 69, 68), PackedInt32Array(74, 73, 71), PackedInt32Array(71, 73, 72), PackedInt32Array(78, 77, 75), PackedInt32Array(75, 77, 76), PackedInt32Array(81, 80, 79), PackedInt32Array(84, 83, 82), PackedInt32Array(86, 85, 87), PackedInt32Array(87, 85, 88), PackedInt32Array(88, 85, 89), PackedInt32Array(93, 92, 90), PackedInt32Array(90, 92, 91)]

[sub_resource type="Environment" id="Environment_la8t5"]
background_mode = 1
ambient_light_source = 2
ambient_light_color = Color(0.385493, 0.385492, 0.385492, 1)
glow_bloom = 1.0
fog_light_color = Color(0, 0, 0, 1)
fog_density = 0.07
volumetric_fog_density = 0.1228
volumetric_fog_albedo = Color(0, 0, 0, 1)
volumetric_fog_emission_energy = 0.0

[sub_resource type="BoxShape3D" id="BoxShape3D_hccy0"]
size = Vector3(10, 15, 30)

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_87q5h"]

[sub_resource type="BoxShape3D" id="BoxShape3D_ap2gm"]
size = Vector3(5, 15, 10)

[sub_resource type="BoxMesh" id="BoxMesh_ph6pe"]
size = Vector3(5, 15, 10)

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_11bpv"]

[node name="Level" type="Node3D"]
script = SubResource("GDScript_w4vx7")
enemy = ExtResource("1_mvf3l")
sentry = ExtResource("2_gg53i")

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="."]
navigation_mesh = SubResource("NavigationMesh_u278t")

[node name="c2_m4" parent="NavigationRegion3D" instance=ExtResource("3_hl1ee")]

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="NavigationRegion3D/c2_m4"]
transform = Transform3D(0.866025, 0.482963, 0.12941, 0, -0.258819, 0.965926, 0.5, -0.836516, -0.224144, -19, 7.73072, 32)
light_color = Color(0.533333, 0.533333, 0.533333, 1)
shadow_enabled = true
sky_mode = 1

[node name="WorldEnvironment" type="WorldEnvironment" parent="NavigationRegion3D/c2_m4"]
environment = SubResource("Environment_la8t5")

[node name="Objective" parent="." instance=ExtResource("1_ghn5u")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 5, 0)
nextscene = ExtResource("2_brmf2")

[node name="ObjectiveItem" parent="Objective" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 143, 0, -70)

[node name="Player" parent="." instance=ExtResource("2_217fp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)

[node name="Trigger" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 56, 1, -37)

[node name="CollisionShape3D" type="CollisionShape3D" parent="Trigger"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 12, 6, 3)
shape = SubResource("BoxShape3D_hccy0")

[node name="Doors" type="Node" parent="."]

[node name="Door" type="StaticBody3D" parent="Doors"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 47, 0, -24)
physics_material_override = SubResource("PhysicsMaterial_87q5h")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Doors/Door"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.5, 0)
shape = SubResource("BoxShape3D_ap2gm")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Doors/Door"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.5, -1)
mesh = SubResource("BoxMesh_ph6pe")
skeleton = NodePath("../../..")

[node name="Door2" type="StaticBody3D" parent="Doors"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 93, 0, -44)
physics_material_override = SubResource("PhysicsMaterial_11bpv")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Doors/Door2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.5, -1)
shape = SubResource("BoxShape3D_ap2gm")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Doors/Door2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.5, -1)
mesh = SubResource("BoxMesh_ph6pe")
skeleton = NodePath("../../..")

[node name="Spawnpoints" type="Node" parent="."]

[node name="Marker3D" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 56, 15, -26)

[node name="Marker3D2" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 56, 15, -34)

[node name="Marker3D3" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 56, 15, -42)

[node name="Marker3D4" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 64, 15, -26)

[node name="Marker3D5" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 64, 15, -34)

[node name="Marker3D6" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 64, 15, -42)

[node name="Marker3D7" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 72, 15, -26)

[node name="Marker3D8" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 72, 15, -34)

[node name="Marker3D9" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 72, 15, -42)

[node name="Marker3D10" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 80, 15, -26)

[node name="Marker3D11" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 80, 15, -34)

[node name="Marker3D12" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 80, 15, -42)

[node name="Marker3D13" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 86, 15, -26)

[node name="Marker3D14" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 86, 15, -34)

[node name="Marker3D15" type="Marker3D" parent="Spawnpoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 86, 15, -42)

[node name="Prop" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 55, 1, -20)

[node name="Prop2" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 65, 1, -20)

[node name="Prop3" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 52, 1, -46)

[node name="Prop4" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.976699, 0, 0.214616, 0, 1, 0, -0.214616, 0, 0.976699, 51.8712, 1, -48.3219)

[node name="Prop5" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.871411, 0, -0.490554, 0, 1, 0, 0.490554, 0, 0.871411, 58.542, 1, -48.3337)

[node name="Prop6" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.975604, 0, -0.21954, 0, 1, 0, 0.21954, 0, 0.975604, 78.9656, 1, -48.2956)

[node name="Prop7" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.92214, 0, 0.386856, 0, 1, 0, -0.386856, 0, 0.92214, 76.0893, 1, -48.5275)

[node name="Prop8" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.991554, 0, -0.129696, 0, 1, 0, 0.129696, 0, 0.991554, 77.3175, 1, -46.0425)

[node name="Prop9" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.965926, 0, 0.258819, 0, 1, 0, -0.258819, 0, 0.965926, 87.9862, 1, -19.7856)

[node name="Prop10" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.970654, 0, -0.240482, 0, 1, 0, 0.240482, 0, 0.970654, 85.1156, 1, -20.4638)

[node name="Prop11" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.965926, 0, 0.258819, 0, 1, 0, -0.258819, 0, 0.965926, 87.9013, 1, -29.2919)

[node name="Prop12" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.965926, 0, -0.258819, 0, 1, 0, 0.258819, 0, 0.965926, 88.0856, 1, -37.455)

[node name="Prop13" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.965926, 0, 0.258819, 0, 1, 0, -0.258819, 0, 0.965926, 61.4506, 1, -48.6694)

[node name="Prop14" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.965926, 0, -0.258819, 0, 1, 0, 0.258819, 0, 0.965926, 32, 1, -7)

[node name="Prop15" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.965926, 0, 0.258819, 0, 1, 0, -0.258819, 0, 0.965926, 57.8758, 1, -19.7164)

[node name="Prop16" parent="." instance=ExtResource("7_ee68b")]
transform = Transform3D(0.965926, 0, 0.258819, 0, 1, 0, -0.258819, 0, 0.965926, 70.0431, 1, -33.4314)

[node name="ExplosiveBarrel" parent="." instance=ExtResource("8_i8g7n")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 69, 1.05, -49)

[node name="ExplosiveBarrel2" parent="." instance=ExtResource("8_i8g7n")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 71, 1.05, -21)

[node name="ExplosiveBarrel3" parent="." instance=ExtResource("8_i8g7n")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 84, 1.05, -28)

[node name="ExplosiveBarrel4" parent="." instance=ExtResource("8_i8g7n")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 53, 1.05, -37)

[node name="ExplosiveBarrel5" parent="." instance=ExtResource("8_i8g7n")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 56, 1.05, -46)

[node name="ExplosiveBarrel6" parent="." instance=ExtResource("8_i8g7n")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 87, 1.05, -35)

[connection signal="body_entered" from="Trigger" to="." method="_on_trigger_body_entered"]

[editable path="Objective"]
